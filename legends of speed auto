local children = workspace.Hoops:GetChildren()

coroutine.wrap(function()
    repeat wait() until game:GetService("Players").LocalPlayer
    local VirtualUser = game:GetService("VirtualUser")
    game:GetService("Players").LocalPlayer.Idled:Connect(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end)
end)()

local farmActive = false

function stopfarm()
    farmActive = false
end

function runfarm()
    farmActive = true
    
    coroutine.wrap(function()
        while farmActive do
            pcall(function()
                for i, child in ipairs(children) do
                    if child.Name == "Hoop" and farmActive then
                        child.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame
                        child.Transparency = 1
                        child.hoopSound.Volume = 0
                        if child:FindFirstChild("hoopParticle") then
                            child.playerParticle:Destroy()
                            child.hoopGui:Destroy()
                            child.hoopParticle:Destroy()
                        end
                    end    
                end
            end)
            wait(0)
        end
    end)()
    
    coroutine.wrap(function()
        while farmActive do
            pcall(function()
                for i,v in pairs(game:GetService("Workspace").orbFolder:GetDescendants()) do
                    if farmActive then
                        if string.match(v.Name, " Orb") then
                            v.outerOrb.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame
                        elseif v.Name == "Gem" then
                            v.outerGem.CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame
                        end
                    end
                end
            end)
            wait(0)
        end
    end)()
end

game.Players.LocalPlayer.CharacterAdded:Connect(function()
    repeat wait() until game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if farmActive then
        stopfarm()
        wait(0.5)
        runfarm()
    end
end)

local TweenService = game:GetService("TweenService")
local ACCENT_COLOR_START = Color3.fromRGB(0, 120, 255) -- Deep Blue
local ACCENT_COLOR_END = Color3.fromRGB(0, 180, 255)   -- Lighter Blue
local ERROR_COLOR = Color3.fromRGB(255, 60, 60)        -- Red/Stop State

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AdvancedFeatherHub"
ScreenGui.Parent = game.CoreGui
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -160, 0.5, -95)
MainFrame.Size = UDim2.new(0, 320, 0, 190)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Name = "MainFrame"

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 16)
UICorner.Parent = MainFrame

local AccentHeader = Instance.new("Frame")
AccentHeader.Parent = MainFrame
AccentHeader.BackgroundColor3 = ACCENT_COLOR_START
AccentHeader.BorderSizePixel = 0
AccentHeader.Size = UDim2.new(1, 0, 0, 5)
AccentHeader.Name = "AccentHeader"

local UIGradient = Instance.new("UIGradient")
UIGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, ACCENT_COLOR_START),
    ColorSequenceKeypoint.new(1, ACCENT_COLOR_END)
})
UIGradient.Rotation = 90
UIGradient.Parent = AccentHeader

local Title = Instance.new("TextLabel")
Title.Parent = MainFrame
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 0, 0, 20)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Font = Enum.Font.GothamBold
Title.Text = "FEATHER HUB"
Title.TextColor3 = Color3.fromRGB(200, 200, 200)
Title.TextSize = 18
Title.Name = "TitleLabel"

local CloseButton = Instance.new("TextButton")
CloseButton.Parent = MainFrame
CloseButton.BackgroundColor3 = Color3.fromRGB(35, 35, 40) -- Dark background for hover effect
CloseButton.BorderSizePixel = 0
CloseButton.Position = UDim2.new(1, -40, 0, 10)
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 18
CloseButton.AutoButtonColor = false
CloseButton.Name = "CloseButton"

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseButton

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Parent = MainFrame
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0, 0, 0, 60)
StatusLabel.Size = UDim2.new(1, 0, 0, 20)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "Status: Idle"
StatusLabel.TextColor3 = ACCENT_COLOR_START
StatusLabel.TextSize = 14
StatusLabel.Name = "StatusLabel"

local FarmButton = Instance.new("TextButton")
FarmButton.Parent = MainFrame
FarmButton.BackgroundColor3 = ACCENT_COLOR_START
FarmButton.BorderSizePixel = 0
FarmButton.Position = UDim2.new(0.5, -140, 0.5, 20)
FarmButton.Size = UDim2.new(0, 280, 0, 60)
FarmButton.Font = Enum.Font.GothamBold
FarmButton.Text = "START HOOP & ORB FARM"
FarmButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FarmButton.TextSize = 18
FarmButton.AutoButtonColor = false
FarmButton.Name = "FarmButton"

local ButtonCorner = Instance.new("UICorner")
ButtonCorner.CornerRadius = UDim.new(0, 10)
ButtonCorner.Parent = FarmButton

local function updateFarmButtonState(isActive)
    local targetColor = isActive and ERROR_COLOR or ACCENT_COLOR_START
    local targetText = isActive and "STOP AUTO FARM" or "START HOOP & ORB FARM"
    local statusText = isActive and "Status: Farming Active" or "Status: Idle"
    local statusColor = isActive and ERROR_COLOR or ACCENT_COLOR_START

    FarmButton.Text = targetText
    StatusLabel.Text = statusText
    StatusLabel.TextColor3 = statusColor

    TweenService:Create(FarmButton, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        BackgroundColor3 = targetColor
    }):Play()
end


FarmButton.MouseEnter:Connect(function()
    local hoverColor = farmActive and Color3.fromRGB(255, 90, 90) or Color3.fromRGB(30, 150, 255)
    TweenService:Create(FarmButton, TweenInfo.new(0.2), {
        BackgroundColor3 = hoverColor
    }):Play()
end)

FarmButton.MouseLeave:Connect(function()
    local normalColor = farmActive and ERROR_COLOR or ACCENT_COLOR_START
    TweenService:Create(FarmButton, TweenInfo.new(0.2), {
        BackgroundColor3 = normalColor
    }):Play()
end)

CloseButton.MouseEnter:Connect(function()
    TweenService:Create(CloseButton, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(50, 50, 55) -- Darker hover
    }):Play()
end)

CloseButton.MouseLeave:Connect(function()
    TweenService:Create(CloseButton, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    }):Play()
end)


FarmButton.MouseButton1Click:Connect(function()
    if not farmActive then
        runfarm()
        updateFarmButtonState(true)
    else
        stopfarm()
        updateFarmButtonState(false)
    end
end)


CloseButton.MouseButton1Click:Connect(function()
    stopfarm()
    ScreenGui:Destroy()
end)


updateFarmButtonState(false)
